<script>
  let memberCount = 0;
  const maxMembers = 15;

  const actualPrices = {
    "IIA Member - LKR 18,500": 18500,
    "Non-Member - LKR 21,500": 21500
  };

  function toggleMemberNo(select) {
    document.getElementById("memberNoDiv").style.display = select.value === "Yes" ? "block" : "none";
  }

  function addMember() {
    if (memberCount >= maxMembers) {
      alert("Maximum of 15 members allowed.");
      return;
    }
    memberCount++;
    const container = document.createElement("div");
    container.className = "member";
    container.dataset.memberId = memberCount;
    container.innerHTML = `
      <button type="button" class="remove-member-btn" onclick="removeMember(this)">Remove</button>
      <h4>Member ${memberCount}</h4>
      <label>Member No: <input type="text" name="memberNo${memberCount}" required></label><br>
      <label>Civil Status:
        <select name="memberCivilStatus${memberCount}" required>
          <option>Mr</option>
          <option>Mrs</option>
          <option>Ms</option>
          <option>Miss</option>
          <option>Dr</option>
          <option>Prof</option>
          <option>Rev</option>
        </select>
      </label><br>
      <label>First Name: <input type="text" name="memberFirstName${memberCount}" required></label><br>
      <label>Last Name: <input type="text" name="memberLastName${memberCount}" required></label><br>
      <label>Designation: <input type="text" name="memberDesignation${memberCount}" required></label><br>
      <label>Email: <input type="email" name="memberEmail${memberCount}" required></label><br>
      <label>Contact No (+Code): <input type="tel" name="memberContact${memberCount}" pattern="\\+\\d{1,3}\\d{10}" required></label>
    `;
    document.getElementById("membersList").appendChild(container);
    updateTotal();
  }

  function removeMember(button) {
    button.parentElement.remove();
    memberCount--;
    renumberMembers();
    updateTotal();
  }

  function renumberMembers() {
    const members = document.querySelectorAll("#membersList .member");
    let count = 0;
    members.forEach((memberDiv) => {
      count++;
      memberDiv.querySelector("h4").textContent = `Member ${count}`;
      memberDiv.dataset.memberId = count;
      memberDiv.querySelector(`input[name^="memberNo"]`).name = `memberNo${count}`;
      memberDiv.querySelector(`select[name^="memberCivilStatus"]`).name = `memberCivilStatus${count}`;
      memberDiv.querySelector(`input[name^="memberFirstName"]`).name = `memberFirstName${count}`;
      memberDiv.querySelector(`input[name^="memberLastName"]`).name = `memberLastName${count}`;
      memberDiv.querySelector(`input[name^="memberDesignation"]`).name = `memberDesignation${count}`;
      memberDiv.querySelector(`input[name^="memberEmail"]`).name = `memberEmail${count}`;
      memberDiv.querySelector(`input[name^="memberContact"]`).name = `memberContact${count}`;
    });
    memberCount = count;
  }

  function updateTotal() {
    const ticketPriceSelect = document.getElementById("ticketPrice");
    let ticketPrice = parseInt(ticketPriceSelect.value) || 0;
    let totalParticipants = 1 + memberCount;
    let totalAmount = ticketPrice * totalParticipants;

    document.getElementById("totalCount").textContent = totalParticipants;
    document.getElementById("totalAmount").textContent = totalAmount.toLocaleString();

    checkPriceMatch();
  }

  function checkPriceMatch() {
    const ticketPriceSelect = document.getElementById("ticketPrice");
    const selectedIndex = ticketPriceSelect.selectedIndex;
    const selectedLabel = ticketPriceSelect.options[selectedIndex]?.text;
    const selectedValue = parseInt(ticketPriceSelect.value);

    if (actualPrices[selectedLabel] && selectedValue !== actualPrices[selectedLabel]) {
      alert(`⚠️ Warning: The selected label "${selectedLabel}" does not match the price LKR ${selectedValue.toLocaleString()}. Please verify.`);
    }
  }

  document.getElementById("ticketPrice").addEventListener("change", updateTotal);
</script>
